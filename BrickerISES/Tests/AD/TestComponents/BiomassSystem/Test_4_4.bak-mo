within BrickerISES.Tests.AD.TestComponents.BiomassSystem;
model Test_4_4
ThermoCycle.Components.Units.Solar.SolarField_Soltigua_Inc        solarCollectorIncSchott(
    Mdotnom=0.5,
    redeclare
      ThermoCycle.Components.HeatFlow.Walls.SolarAbsorber.Geometry.Soltigua.PTMx_18
      CollectorGeometry,
    redeclare package Medium1 =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Discretization=ThermoCycle.Functions.Enumerations.Discretizations.upwind_AllowFlowReversal,
    redeclare model FluidHeatTransferModel =
        ThermoCycle.Components.HeatFlow.HeatTransfer.Ideal,
    N=5,
    Ns=19,
    Tstart_inlet=424.15,
    Tstart_outlet=482.15,
    pstart=100000)
    annotation (Placement(transformation(extent={{-124,-228},{-82,-158}})));
  Modelica.Blocks.Sources.Constant const1(
                                         k=25)
    annotation (Placement(transformation(extent={{-208,-206},{-188,-186}})));
  Modelica.Blocks.Sources.Constant const2(k=0)
    annotation (Placement(transformation(extent={{-208,-174},{-188,-154}})));
  Modelica.Blocks.Sources.Constant const3(k=0)
    annotation (Placement(transformation(extent={{-200,-128},{-180,-108}})));
  Modelica.Blocks.Sources.Step step(
    startTime=200,
    height=0,
    offset=1000)
    annotation (Placement(transformation(extent={{-208,-240},{-188,-220}})));
  Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=false)
    annotation (Placement(transformation(extent={{-206,-278},{-186,-258}})));
 Components.Valve_lin             valve3(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Xopen=0.04,
    Mdot_nom=0.1,
    Afull=2.5e-05)
                annotation (Placement(transformation(extent={{-10,-10},{10,10}},
        rotation=90,
        origin={-6,-188})));
  Modelica.Blocks.Sources.Constant const4(k=0.04)
    annotation (Placement(transformation(extent={{-50,-192},{-40,-182}})));
  ThermoCycle.Components.FluidFlow.Sensors.SensTp sensTp1(
                                                         redeclare package
      Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP)
    annotation (Placement(transformation(extent={{34,-114},{54,-94}})));
  ThermoCycle.Components.Units.PdropAndValves.DP dP3(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    h=0,
    A=5e3,
    k=2.96E+07)
         annotation (Placement(transformation(extent={{-68,-120},{-48,-100}})));
 ThermoCycle.Components.FluidFlow.Reservoirs.SinkP sinkP(redeclare package
      Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    h=551.7e3,
    p0=450000)
    annotation (Placement(transformation(extent={{128,20},{148,40}})));
Components.Valve_lin             valve(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Mdot_nom=0.1,
    CheckValve=true,
    Xopen=0.6923,
    Afull=5.20006e-05)
                annotation (Placement(transformation(extent={{44,-46},{24,-26}})));
Components.Valve_lin             valve1(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Mdot_nom=0.1,
    CheckValve=true,
    Xopen=0.8085,
    Afull=0.000188002)
                annotation (Placement(transformation(extent={{-10,-10},{10,10}},
        rotation=-90,
        origin={-88,24})));

  ThermoCycle.Components.Units.ExpansionAndCompressionMachines.Pump pump(
    PumpInput=ThermoCycle.Functions.Enumerations.PumpInputs.FF,
    X_pp0=0.5,
    eta_is=0.7,
    M_dot_start=9.4,
    hstart=564.9e3,
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    PumpType=ThermoCycle.Functions.Enumerations.PumpTypes.UD,
    V_dot_max=0.0264686,
    p_su_start=400000)
    annotation (Placement(transformation(extent={{-144,-46},{-164,-26}})));
  ThermoCycle.Components.FluidFlow.Pipes.Cell1DimInc cell1DimInc(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Vi=0.03,
    Ai=16,
    Mdotnom=9.4,
    Unom=100,
    pstart=400000) annotation (Placement(transformation(
        extent={{-10,-10},{10,10}},
        rotation=90,
        origin={-194,14})));
  ThermoCycle.Components.FluidFlow.Reservoirs.SourceP sourceP(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    p0=400000,
    T_0=424.15)
    annotation (Placement(transformation(extent={{98,-232},{118,-212}})));
  ThermoCycle.Components.Units.ExpansionAndCompressionMachines.Pump pump1(
    PumpInput=ThermoCycle.Functions.Enumerations.PumpInputs.FF,
    X_pp0=0.5,
    eta_is=0.7,
    M_dot_start=9.4,
    hstart=564.9e3,
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    PumpType=ThermoCycle.Functions.Enumerations.PumpTypes.UD,
    V_dot_max=0.00664505,
    p_su_start=400000)
    annotation (Placement(transformation(extent={{62,-272},{42,-252}})));
  Modelica.Fluid.Fittings.TeeJunctionIdeal teeJunctionIdeal(redeclare package
      Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP)
    annotation (Placement(transformation(extent={{-76,-40},{-96,-20}})));
  Modelica.Fluid.Fittings.TeeJunctionIdeal teeJunctionIdeal1(redeclare package
      Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP)
    annotation (Placement(transformation(extent={{-100,70},{-80,50}})));
  Modelica.Fluid.Fittings.TeeJunctionIdeal teeJunctionIdeal2(redeclare package
      Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP)
    annotation (Placement(transformation(extent={{106,-44},{86,-24}})));
equation
  connect(step.y,solarCollectorIncSchott. DNI) annotation (Line(
      points={{-187,-230},{-160,-230},{-160,-204.136},{-121.9,-204.136}},
      color={0,0,127},
      smooth=Smooth.None));
  connect(booleanConstant.y,solarCollectorIncSchott. Defocusing) annotation (
      Line(
      points={{-185,-268},{-138,-268},{-138,-217.818},{-121.667,-217.818}},
      color={255,0,255},
      smooth=Smooth.None));
  connect(valve3.InFlow,solarCollectorIncSchott. InFlow) annotation (Line(
      points={{-6,-197},{-6,-256},{-98.8,-256},{-98.8,-228.636}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(const4.y,valve3. cmd) annotation (Line(
      points={{-39.5,-187},{-32,-187},{-32,-188},{-14,-188}},
      color={0,0,127},
      smooth=Smooth.None));
  connect(valve3.OutFlow,sensTp1. InFlow) annotation (Line(
      points={{-6,-179},{-6,-110},{37,-110},{37,-108.8}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(const2.y,solarCollectorIncSchott. Theta) annotation (Line(
      points={{-187,-164},{-162,-164},{-162,-177.091},{-121.667,-177.091}},
      color={0,0,127},
      smooth=Smooth.None));
  connect(const1.y,solarCollectorIncSchott. Tamb) annotation (Line(
      points={{-187,-196},{-160,-196},{-160,-191.091},{-121.667,-191.091}},
      color={0,0,127},
      smooth=Smooth.None));
  connect(const3.y,solarCollectorIncSchott. v_wind) annotation (Line(
      points={{-179,-118},{-158,-118},{-158,-163.727},{-121.2,-163.727}},
      color={0,0,127},
      smooth=Smooth.None));
  connect(solarCollectorIncSchott.OutFlow, dP3.InFlow) annotation (Line(
      points={{-96,-158.636},{-98,-158.636},{-98,-110},{-67,-110}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(dP3.OutFlow, sensTp1.InFlow) annotation (Line(
      points={{-49,-110},{37,-110},{37,-108.8}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(cell1DimInc.InFlow, pump.OutFlow) annotation (Line(
      points={{-194,4},{-194,-28.6},{-159.6,-28.6}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(pump1.OutFlow, solarCollectorIncSchott.InFlow) annotation (Line(
      points={{46.4,-254.6},{18,-254.6},{18,-256},{-98.8,-256},{-98.8,-228.636}},
      color={0,0,255},
      smooth=Smooth.None));

  connect(pump1.InFlow, sourceP.flange) annotation (Line(
      points={{59.2,-261.5},{142,-261.5},{142,-222},{117.4,-222}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(valve1.OutFlow, teeJunctionIdeal.port_3) annotation (Line(
      points={{-88,15},{-88,-4},{-86,-4},{-86,-20}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(teeJunctionIdeal.port_1, valve.OutFlow) annotation (Line(
      points={{-76,-30},{-34,-30},{-34,-36},{25,-36}},
      color={0,127,255},
      smooth=Smooth.None));
  connect(pump.InFlow, teeJunctionIdeal.port_2) annotation (Line(
      points={{-146.8,-35.5},{-124,-35.5},{-124,-28},{-96,-28},{-96,-30}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(cell1DimInc.OutFlow, teeJunctionIdeal1.port_1) annotation (Line(
      points={{-194.1,24},{-194.1,60},{-100,60}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(teeJunctionIdeal1.port_3, valve1.InFlow) annotation (Line(
      points={{-90,50},{-92,50},{-92,33},{-88,33}},
      color={0,127,255},
      smooth=Smooth.None));
  connect(teeJunctionIdeal1.port_2, sinkP.flangeB) annotation (Line(
      points={{-80,60},{-8,60},{-8,30},{129.6,30}},
      color={0,127,255},
      smooth=Smooth.None));
  connect(sensTp1.OutFlow, teeJunctionIdeal2.port_1) annotation (Line(
      points={{51,-108.8},{152,-108.8},{152,-34},{106,-34}},
      color={0,0,255},
      smooth=Smooth.None));
  connect(teeJunctionIdeal2.port_2, valve.InFlow) annotation (Line(
      points={{86,-34},{43,-34},{43,-36}},
      color={0,127,255},
      smooth=Smooth.None));
  connect(teeJunctionIdeal2.port_3, sinkP.flangeB) annotation (Line(
      points={{96,-24},{96,30},{129.6,30}},
      color={0,127,255},
      smooth=Smooth.None));
  annotation (Diagram(coordinateSystem(extent={{-280,-320},{160,120}},
          preserveAspectRatio=false), graphics), Icon(coordinateSystem(extent={
            {-280,-320},{160,120}})));
end Test_4_4;
