within BrickerISES.Tests.AD.TestComponents;
model Test_SF_MB_ORC_2

  ThermoCycle.Components.Units.PdropAndValves.Valve valve(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Mdot_nom=0.1,
    Xopen=0.307,
    Afull=0.000302563,
    DELTAp_nom=50000,
    t_init=1000,
    constinit=true)
                annotation (Placement(transformation(extent={{-10,-10},{10,10}},
        rotation=90,
        origin={-40,114})));

  ThermoCycle.Components.Units.PdropAndValves.DP dP(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    h=0,
    A=5e3,
    k=2.06049e+07,
    DELTAp_start=50000,
    t_init=1000,
    constinit=true)
         annotation (Placement(transformation(extent={{-60,38},{-80,58}})));
  ThermoCycle.Components.Units.PdropAndValves.DP dP1(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    h=0,
    A=5e3,
    k=1.95179e+07,
    DELTAp_start=50000,
    t_init=1000,
    constinit=true)
         annotation (Placement(transformation(extent={{-96,166},{-76,186}})));
  ThermoCycle.Components.Units.PdropAndValves.Valve valve1(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Mdot_nom=0.1,
    Xopen=0.8085,
    Afull=0.00112141,
    DELTAp_nom=50000,
    t_init=1000,
    constinit=true)
                annotation (Placement(transformation(extent={{10,-10},{-10,10}},
        rotation=90,
        origin={-110,116})));
  Components.Biomass.Flow1DIncHeatInput flow1DIncHeatInput(
    N=10,
    Discretization=ThermoCycle.Functions.Enumerations.Discretizations.upwind_AllowFlowReversal,
    QcombustionNominal=258e3,
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    QcombustionStart=258e3,
    CombustionInitialization=Modelica.Blocks.Types.Init.SteadyState,
    redeclare model combustionDynamic =
        BrickerISES.Components.Biomass.CombustionDynamic.CostantPowerCombustion,
    Vint=0.3,
    pstart=100000,
    Tstart_inlet=523.15,
    Tstart_outlet=533.15,
    Tstart_inlet_wall=528.15,
    Tstart_outlet_wall=538.15) annotation (Placement(transformation(
        extent={{25,-26},{-25,26}},
        rotation=90,
        origin={-217,106})));

  Modelica.Blocks.Sources.Constant const(k=1)
    annotation (Placement(transformation(extent={{-270,96},{-256,110}})));
  ThermoCycle.Components.Units.ExpansionAndCompressionMachines.Pump pump(
    PumpInput=ThermoCycle.Functions.Enumerations.PumpInputs.FF,
    X_pp0=0.5,
    eta_is=0.7,
    M_dot_start=9.4,
    hstart=564.9e3,
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    PumpType=ThermoCycle.Functions.Enumerations.PumpTypes.UD,
    V_dot_max=0.0264686,
    p_su_start=400000)
    annotation (Placement(transformation(extent={{-148,38},{-168,58}})));
  ThermoCycle.Components.Units.PdropAndValves.DP dP2(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    h=0,
    A=5e3,
    k=1.12124e+07,
    DELTAp_start=150000,
    t_init=1000,
    constinit=true)
         annotation (Placement(transformation(extent={{10,-10},{-10,10}},
        rotation=-90,
        origin={-220,154})));
  ThermoCycle.Components.Units.Tanks.OpenTank openTank(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Mdotnom=9.4,
    L_lstart=0.99,
    V_tank=0.03,
    p_ext=450000,
    Tstart=533.15,
    pstart=450000)
    annotation (Placement(transformation(extent={{-200,174},{-180,194}})));
  ThermoCycle.Components.FluidFlow.Sensors.SensTp sensTp(redeclare package
      Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP)
    annotation (Placement(transformation(extent={{-66,170},{-46,190}})));
  ThermoCycle.Components.FluidFlow.Sensors.SensTp sensTp1(redeclare package
      Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP)
    annotation (Placement(transformation(extent={{-188,50},{-208,70}})));
ThermoCycle.Components.Units.Solar.SolarField_Soltigua_Inc        solarCollectorIncSchott(
    Mdotnom=0.5,
    redeclare
      ThermoCycle.Components.HeatFlow.Walls.SolarAbsorber.Geometry.Soltigua.PTMx_18
      CollectorGeometry,
    redeclare package Medium1 =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Discretization=ThermoCycle.Functions.Enumerations.Discretizations.upwind_AllowFlowReversal,
    redeclare model FluidHeatTransferModel =
        ThermoCycle.Components.HeatFlow.HeatTransfer.Ideal,
    N=5,
    Ns=19,
    Tstart_inlet=424.15,
    Tstart_outlet=482.15,
    pstart=100000)
    annotation (Placement(transformation(extent={{-214,-132},{-172,-62}})));
  Modelica.Blocks.Sources.Constant const1(
                                         k=25)
    annotation (Placement(transformation(extent={{-284,-112},{-264,-92}})));
  Modelica.Blocks.Sources.Constant const2(k=0)
    annotation (Placement(transformation(extent={{-284,-80},{-264,-60}})));
  Modelica.Blocks.Sources.Constant const3(k=0)
    annotation (Placement(transformation(extent={{-280,-42},{-260,-22}})));
  Modelica.Blocks.Sources.Step step(
    startTime=200,
    height=0,
    offset=1000)
    annotation (Placement(transformation(extent={{-284,-146},{-264,-126}})));
  Modelica.Blocks.Sources.BooleanConstant booleanConstant(k=false)
    annotation (Placement(transformation(extent={{-282,-184},{-262,-164}})));
 ThermoCycle.Components.FluidFlow.Reservoirs.SourceMdot sourceMdot1(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Mdot_0=2.6,
    p=100000,
    T_0=424.15)
    annotation (Placement(transformation(extent={{8,-170},{-12,-150}})));
  ThermoCycle.Components.Units.PdropAndValves.DP dP3(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    h=0,
    A=5e3,
    k=2.96E+07,
    t_init=1000,
    constinit=true,
    DELTAp_start=100000)
         annotation (Placement(transformation(extent={{-152,-54},{-132,-34}})));
  ThermoCycle.Components.Units.PdropAndValves.Valve valve2(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Xopen=0.04,
    Mdot_nom=0.1,
    Afull=0.000199767,
    DELTAp_nom=50000,
    t_init=1000,
    constinit=true)
                annotation (Placement(transformation(extent={{-10,-10},{10,10}},
        rotation=90,
        origin={-96,-110})));
  Modelica.Blocks.Sources.Constant const4(k=0.04)
    annotation (Placement(transformation(extent={{-142,-114},{-132,-104}})));
  ThermoCycle.Components.FluidFlow.Sensors.SensTp sensTp2(redeclare package
      Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP)
    annotation (Placement(transformation(extent={{-52,-48},{-32,-28}})));
  Modelica.Blocks.Sources.Constant const5(k=0.8085)
    annotation (Placement(transformation(extent={{-156,112},{-146,122}})));
  Modelica.Blocks.Sources.Constant const6(k=0.307)
    annotation (Placement(transformation(extent={{-74,122},{-64,132}})));
  ThermoCycle.Components.Units.PdropAndValves.DP dP4(
    redeclare package Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    h=0,
    A=5e3,
    k=1.37322e+07,
    DELTAp_start=50000,
    t_init=1000,
    constinit=true)
         annotation (Placement(transformation(extent={{12,102},{32,122}})));
  ThermoCycle.Components.Units.HeatExchangers.Hx1DInc hx1DInc(
    redeclare package Medium2 =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP,
    Mdotnom_sf=2.6,
    Mdotnom_wf=2.5,
    N=15,
    Discretization=ThermoCycle.Functions.Enumerations.Discretizations.upwind_AllowFlowReversal,
    Unom_sf=1000,
    Unom_l=1000,
    Unom_tp=8000,
    Unom_v=2000,
    A_sf=80,
    A_wf=80,
    pstart_sf=350000,
    pstart_wf=1800000,
    Tstart_inlet_wf=333.15,
    Tstart_outlet_wf=403.15,
    Tstart_inlet_sf=518.15,
    Tstart_outlet_sf=427.15,
    steadystate_T_wall=true)
    annotation (Placement(transformation(extent={{25,22},{-25,-22}},
        rotation=-90,
        origin={159,34})));
  ThermoCycle.Components.FluidFlow.Reservoirs.SourceMdot sourceMdot2(
    redeclare package Medium = ThermoCycle.Media.R245fa_CP,
    Mdot_0=2.5,
    p=100000,
    T_0=333.15)
    annotation (Placement(transformation(extent={{-10,10},{10,-10}},
        rotation=180,
        origin={170,-36})));
  ThermoCycle.Components.FluidFlow.Reservoirs.SinkP sinkP1(redeclare package
      Medium = ThermoCycle.Media.R245fa_CP, p0=2500000)
    annotation (Placement(transformation(extent={{-10,-10},{10,10}},
        rotation=0,
        origin={232,-30})));
  ThermoCycle.Components.FluidFlow.Sensors.SensTp sensTp3(redeclare package
      Medium =
        ThermoCycle.Media.Incompressible.IncompressibleTables.TherminolSP)
    annotation (Placement(transformation(
        extent={{10,-10},{-10,10}},
        rotation=-90,
        origin={118,14})));
equation
  connect(valve.InFlow, dP.InFlow) annotation (Line(
      points={{-40,105},{-40,48},{-61,48}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(valve1.OutFlow, dP.OutFlow) annotation (Line(
      points={{-110,107},{-110,48},{-79,48}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(const.y, flow1DIncHeatInput.u) annotation (Line(
      points={{-255.3,103},{-246,103},{-246,106},{-237.8,106}},
      color={0,0,127},
      smooth=Smooth.None,
      pattern=LinePattern.Dot,
      thickness=0.5));
  connect(dP1.InFlow, valve1.InFlow) annotation (Line(
      points={{-95,176},{-110,176},{-110,125}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(valve1.OutFlow, pump.InFlow) annotation (Line(
      points={{-110,107},{-110,48.5},{-150.8,48.5}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(dP2.InFlow, flow1DIncHeatInput.outlet_fl2) annotation (Line(
      points={{-220,145},{-222,145},{-222,130.5},{-220.12,130.5}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(openTank.OutFlow, valve1.InFlow) annotation (Line(
      points={{-180.2,175.6},{-110,175.6},{-110,125}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(dP2.OutFlow, openTank.InFlow) annotation (Line(
      points={{-220,163},{-220,175.6},{-199.8,175.6}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(dP1.OutFlow, sensTp.InFlow) annotation (Line(
      points={{-77,176},{-66,176},{-66,175.2},{-63,175.2}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(sensTp1.InFlow, pump.OutFlow) annotation (Line(
      points={{-191,55.2},{-182,55.2},{-182,55.4},{-163.6,55.4}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(flow1DIncHeatInput.inlet_fl2, sensTp1.OutFlow) annotation (Line(
      points={{-220.64,81},{-220.64,55.2},{-205,55.2}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(const3.y,solarCollectorIncSchott. v_wind) annotation (Line(
      points={{-259,-32},{-220,-32},{-220,-70},{-211.2,-70},{-211.2,-67.7273}},
      color={0,0,127},
      smooth=Smooth.None,
      pattern=LinePattern.Dot,
      thickness=0.5));
  connect(step.y,solarCollectorIncSchott. DNI) annotation (Line(
      points={{-263,-136},{-220,-136},{-220,-108.136},{-211.9,-108.136}},
      color={0,0,127},
      smooth=Smooth.None,
      pattern=LinePattern.Dot,
      thickness=0.5));
  connect(booleanConstant.y,solarCollectorIncSchott. Defocusing) annotation (
      Line(
      points={{-261,-174},{-232,-174},{-232,-121.818},{-211.667,-121.818}},
      color={255,0,255},
      smooth=Smooth.None,
      pattern=LinePattern.Dot,
      thickness=0.5));
  connect(sourceMdot1.flangeB, solarCollectorIncSchott.InFlow) annotation (Line(
      points={{-11,-160},{-188.8,-160},{-188.8,-132.636}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(solarCollectorIncSchott.OutFlow, dP3.InFlow) annotation (Line(
      points={{-186,-62.6364},{-186,-44},{-151,-44}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(valve2.InFlow, solarCollectorIncSchott.InFlow) annotation (Line(
      points={{-96,-119},{-96,-160},{-188.8,-160},{-188.8,-132.636}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(const4.y, valve2.cmd) annotation (Line(
      points={{-131.5,-109},{-122,-109},{-122,-110},{-104,-110}},
      color={0,0,127},
      smooth=Smooth.None,
      pattern=LinePattern.Dot,
      thickness=0.5));
  connect(sensTp2.InFlow, valve2.OutFlow) annotation (Line(
      points={{-49,-42.8},{-74,-42.8},{-74,-44},{-96,-44},{-96,-101}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(dP3.OutFlow, valve2.OutFlow) annotation (Line(
      points={{-133,-44},{-96,-44},{-96,-101}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(const2.y, solarCollectorIncSchott.Theta) annotation (Line(
      points={{-263,-70},{-248,-70},{-248,-81.0909},{-211.667,-81.0909}},
      color={0,0,127},
      smooth=Smooth.None,
      pattern=LinePattern.Dot,
      thickness=0.5));
  connect(const1.y, solarCollectorIncSchott.Tamb) annotation (Line(
      points={{-263,-102},{-248,-102},{-248,-95.0909},{-211.667,-95.0909}},
      color={0,0,127},
      smooth=Smooth.None,
      pattern=LinePattern.Dot,
      thickness=0.5));
  connect(sensTp2.OutFlow, dP.InFlow) annotation (Line(
      points={{-35,-42.8},{28,-42.8},{28,48},{-61,48}},
      color={0,0,255},
      smooth=Smooth.None,
      thickness=0.5));
  connect(const6.y, valve.cmd) annotation (Line(
      points={{-63.5,127},{-60,127},{-60,114},{-48,114}},
      color={0,0,127},
      smooth=Smooth.None,
      pattern=LinePattern.Dot,
      thickness=0.5));
  connect(const5.y, valve1.cmd) annotation (Line(
      points={{-145.5,117},{-128,117},{-128,116},{-118,116}},
      color={0,0,127},
      smooth=Smooth.None,
      pattern=LinePattern.Dot,
      thickness=0.5));
  connect(sensTp.OutFlow, valve.OutFlow) annotation (Line(
      points={{-49,175.2},{-40,175.2},{-40,123}},
      color={0,0,255},
      smooth=Smooth.None));

  connect(sensTp.OutFlow, dP4.InFlow) annotation (Line(
      points={{-49,175.2},{-2,175.2},{-2,112},{13,112}},
      color={0,0,255},
      smooth=Smooth.None));

  connect(dP4.OutFlow, hx1DInc.inlet_fl2) annotation (Line(
      points={{31,112},{148.846,112},{148.846,52.8462}},
      color={0,0,255},
      smooth=Smooth.None));
  annotation (Diagram(coordinateSystem(preserveAspectRatio=false, extent={{-320,
            -220},{300,200}}), graphics), Icon(coordinateSystem(extent={{-320,-220},
            {300,200}})));
end Test_SF_MB_ORC_2;
